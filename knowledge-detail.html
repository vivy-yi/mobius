<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知识详情 - Mobius专业知识库</title>
    <meta name="description" content="Mobius专业知识库详细内容，提供深度分析和专业评论">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./styles/unified-responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="./styles/css/components/knowledge-detail.css">
        
    <!-- Knowledge detail styles are included in the main style.css -->

    <!-- 详情页布局样式 -->
    <style>
        /* 响应式三栏布局 */
        .knowledge-detail-main {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }

        /* 左侧：文章目录 */
        .detail-sidebar-left {
            flex: 0 0 280px;
        }

        /* 中间：文章内容 */
        .detail-content-center {
            flex: 1;
            min-width: 0;
        }

        /* 右侧：专家分析、标签、相关知识 */
        .detail-sidebar-right {
            flex: 0 0 300px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* 底部交互和评论区域 */
        .detail-footer-section {
            margin-top: 3rem;
            border-top: 1px solid #e5e7eb;
            padding-top: 2rem;
        }

        .detail-article-interactions {
            margin-bottom: 2rem;
        }

        .interaction-stats {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .detail-interaction-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .detail-interaction-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #f0f9ff;
        }

        /* 评论区域 */
        .detail-comments-section {
            margin-top: 2rem;
        }

        .comments-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .comments-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .comments-count {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .comment-input-area {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 12px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .comment-input-wrapper {
            flex: 1;
        }

        .comment-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.875rem;
            resize: vertical;
            min-height: 80px;
        }

        .comment-actions {
            margin-top: 0.5rem;
            text-align: right;
        }

        .comment-submit-btn {
            padding: 0.5rem 1rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comment-submit-btn:hover {
            background: #2563eb;
        }

        /* 响应式布局 */
        @media (max-width: 1200px) {
            .knowledge-detail-main {
                flex-direction: column;
            }

            .detail-sidebar-left,
            .detail-sidebar-right {
                flex: none;
                width: 100%;
            }

            .detail-sidebar-right {
                order: -1; /* 右侧内容放在前面 */
            }
        }

        /* 基于容器宽度的动态响应式 */
        .knowledge-detail-main {
            container-type: inline-size;
            container-name: knowledge-detail-layout;
        }

        /* 大屏幕布局：三栏 */
        @container knowledge-detail-layout (min-width: 1201px) {
            .knowledge-detail-main {
                flex-direction: row;
                gap: 2rem;
            }

            .detail-sidebar-left {
                flex: 0 0 280px;
                display: block;
            }

            .detail-content-center {
                flex: 1;
                min-width: 0;
            }

            .detail-sidebar-right {
                flex: 0 0 300px;
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }
        }

        /* 中等屏幕布局：单列堆叠 */
        @container knowledge-detail-layout (min-width: 769px) and (max-width: 1200px) {
            .knowledge-detail-main {
                flex-direction: column;
                gap: 2rem;
            }

            .detail-sidebar-left,
            .detail-sidebar-right {
                flex: none;
                width: 100%;
                display: block;
            }

            .detail-sidebar-right {
                order: -1;
            }
        }

        /* 小屏幕布局：内容优先 */
        @container knowledge-detail-layout (max-width: 768px) {
            .knowledge-detail-main {
                flex-direction: column;
                gap: 1.5rem;
                padding: 1rem 0.5rem;
            }

            .detail-sidebar-left,
            .detail-sidebar-right {
                display: none;
            }

            .detail-content-center {
                max-width: none;
                width: 100%;
            }

            /* 基于容器宽度的交互元素优化 */
            .interaction-stats {
                flex-wrap: wrap;
                gap: 0.75rem;
            }

            .comment-input-area {
                flex-direction: column;
            }

            /* 基于容器宽度的内容优化 */
            .detail-article-body {
                padding: 1rem 0;
                font-size: 1rem;
                line-height: 1.6;
            }

            /* 交互按钮优化 */
            .detail-interaction-btn {
                flex: 1 1 calc(50% - 0.375rem);
                min-width: 120px;
                padding: 0.75rem;
                font-size: 0.875rem;
            }

            /* 评论输入框优化 */
            .comment-input {
                min-height: 100px;
                resize: vertical;
            }

            .comment-avatar {
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }
        }

        @container knowledge-detail-layout (max-width: 480px) {
            .detail-interaction-btn {
                flex: 1 1 100%;
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== 知识详情页面容器查询支持 ===== */

        /* Layout Component Container Queries */
        @container layout-component (max-width: 800px) {
            .knowledge-detail-main {
                flex-direction: column;
                gap: var(--spacing-lg);
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .detail-sidebar-left {
                flex: none;
                order: 2;
                margin-top: var(--spacing-lg);
            }

            .detail-content-center {
                order: 1;
            }

            .detail-sidebar-right {
                flex: none;
                order: 3;
                margin-top: var(--spacing-lg);
            }
        }

        @container layout-component (min-width: 801px) and (max-width: 1200px) {
            .knowledge-detail-main {
                gap: var(--spacing-xl);
            }

            .detail-sidebar-left {
                flex: 0 0 240px;
            }

            .detail-sidebar-right {
                flex: 0 0 260px;
            }
        }

        @container layout-component (min-width: 1201px) {
            .knowledge-detail-main {
                max-width: 1400px;
                gap: var(--spacing-2xl);
            }

            .detail-sidebar-left {
                flex: 0 0 300px;
            }

            .detail-sidebar-right {
                flex: 0 0 340px;
            }
        }

        /* Card Component Container Queries */
        @container card-component (max-width: 280px) {
            .detail-toc-container,
            .expert-analysis,
            .related-tags,
            .related-knowledge {
                padding: var(--spacing-md);
            }

            .detail-toc-header h3,
            .analysis-header h3,
            .tags-header h3 {
                font-size: var(--font-size-base);
            }

            .analysis-item {
                padding: var(--spacing-sm);
            }

            .tag-item {
                font-size: var(--font-size-sm);
                padding: 4px 8px;
            }
        }

        @container card-component (min-width: 281px) and (max-width: 400px) {
            .detail-toc-container,
            .expert-analysis,
            .related-tags,
            .related-knowledge {
                padding: var(--spacing-lg);
            }

            .detail-toc-header h3,
            .analysis-header h3,
            .tags-header h3 {
                font-size: var(--font-size-lg);
            }

            .analysis-item {
                padding: var(--spacing-md);
            }
        }

        @container card-component (min-width: 401px) {
            .detail-toc-container,
            .expert-analysis,
            .related-tags,
            .related-knowledge {
                padding: var(--spacing-xl);
            }

            .detail-toc-header h3,
            .analysis-header h3,
            .tags-header h3 {
                font-size: var(--font-size-xl);
            }
        }

        /* Content Center Container Queries */
        @container card-component (max-width: 600px) {
            .detail-article-header {
                padding: var(--spacing-lg);
                text-align: center;
            }

            .detail-article-meta {
                flex-direction: column;
                gap: var(--spacing-sm);
                align-items: center;
            }

            .detail-article-content {
                padding: var(--spacing-lg);
            }

            .detail-article-content h2,
            .detail-article-content h3 {
                font-size: var(--font-size-lg);
            }
        }

        @container card-component (min-width: 601px) and (max-width: 900px) {
            .detail-article-header {
                padding: var(--spacing-xl);
            }

            .detail-article-content {
                padding: var(--spacing-xl);
            }

            .detail-article-content h2 {
                font-size: var(--font-size-xl);
            }

            .detail-article-content h3 {
                font-size: var(--font-size-lg);
            }
        }

        @container card-component (min-width: 901px) {
            .detail-article-header {
                padding: var(--spacing-2xl);
            }

            .detail-article-content {
                padding: var(--spacing-2xl);
            }

            .detail-article-content h2 {
                font-size: var(--font-size-2xl);
            }

            .detail-article-content h3 {
                font-size: var(--font-size-xl);
            }
        }

        /* Enhanced Tablet Support */
        @media (min-width: 769px) and (max-width: 1024px) {
            @container layout-component (min-width: 700px) {
                .knowledge-detail-main {
                    flex-direction: row;
                }

                .detail-sidebar-left {
                    order: 1;
                    flex: 0 0 220px;
                }

                .detail-content-center {
                    order: 2;
                }

                .detail-sidebar-right {
                    order: 3;
                    flex: 0 0 240px;
                }
            }

            @container card-component (min-width: 250px) {
                .detail-toc-container {
                    position: sticky;
                    top: calc(var(--navbar-height) + var(--spacing-md));
                }
            }
        }

        /* Device-Specific Detail Page Enhancements */
        @supports (container-type: inline-size) {
            .device-tablet .detail-toc-container,
            .device-tablet .expert-analysis,
            .device-tablet .related-tags,
            .device-tablet .related-knowledge {
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }

            .device-tablet .detail-toc-container:active,
            .device-tablet .expert-analysis:active,
            .device-tablet .related-tags:active,
            .device-tablet .related-knowledge:active {
                transform: scale(0.98);
            }

            .device-hybrid .detail-toc-container:hover,
            .device-hybrid .expert-analysis:hover,
            .device-hybrid .related-tags:hover,
            .device-hybrid .related-knowledge:hover {
                box-shadow: var(--shadow-lg);
            }

            .device-mobile .knowledge-detail-main {
                padding: var(--spacing-md);
            }
        }

      </style>
</head>
<body class="knowledge-detail-body">
    <!-- 主导航栏 -->
    <nav id="navbar">
        <!-- 导航内容将通过 components.js 动态加载 -->
    </nav>

    <!-- 面包屑导航 -->
    <div class="breadcrumb-container">
        <nav class="breadcrumb">
            <a href="./index.html">首页</a>
            <i class="fas fa-chevron-right"></i>
            <a href="./knowledge.html">知识库</a>
            <i class="fas fa-chevron-right"></i>
            <span id="current-category">分类</span>
            <i class="fas fa-chevron-right"></i>
            <span id="current-title">文章标题</span>
        </nav>
    </div>

    <!-- 知识详情页面主体 -->
    <main class="knowledge-detail-main layout-component-container">
        <!-- 左侧：文章目录 -->
        <aside class="detail-sidebar-left">
            <div class="detail-toc-container card-container">
                <div class="detail-toc-header">
                    <i class="fas fa-list"></i>
                    <h3>文章目录</h3>
                </div>
                <nav class="detail-toc" id="detailToc">
                    <!-- 目录项将通过JavaScript动态生成 -->
                </nav>
            </div>
        </aside>

        <!-- 中间：文章内容 -->
        <section class="detail-content-center card-container">
            <!-- 文章头部信息 -->
            <header class="detail-article-header">
                <div class="detail-author-info">
                    <div class="detail-author-avatar">M</div>
                    <div class="detail-author-details">
                        <div class="detail-author-name">Mobius专业团队</div>
                        <div class="detail-article-meta">
                            <span class="detail-article-date" id="articleDate">2024年1月15日</span>
                            <span class="detail-article-reading" id="readingTime">5分钟阅读</span>
                            <span class="detail-article-category" id="articleCategory">分类</span>
                        </div>
                    </div>
                </div>
                <h1 class="detail-article-title" id="articleTitle">文章标题</h1>
                <div class="detail-article-excerpt" id="articleExcerpt">
                    文章摘要内容
                </div>
            </header>

            <!-- 文章正文内容 -->
            <div class="detail-article-body" id="articleBody">
                <!-- 文章内容将通过JavaScript动态加载 -->
                <div class="loading-placeholder">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>正在加载文章内容...</p>
                </div>
            </div>

            <!-- 底部：点赞、收藏、分享和用户评论 -->
            <section class="detail-footer-section">
                <!-- 互动区域 -->
                <div class="detail-article-interactions">
                    <div class="interaction-stats">
                        <button class="detail-interaction-btn detail-helpful-btn" id="helpfulBtn">
                            <i class="fas fa-thumbs-up"></i>
                            <span class="interaction-count">有帮助</span>
                        </button>
                        <button class="detail-interaction-btn detail-bookmark-btn" id="bookmarkBtn">
                            <i class="fas fa-bookmark"></i>
                            <span class="interaction-count">收藏</span>
                        </button>
                        <button class="detail-interaction-btn detail-share-btn" id="shareBtn">
                            <i class="fas fa-share"></i>
                            <span class="interaction-count">分享</span>
                        </button>
                    </div>
                </div>

                <!-- 用户评论区域 -->
                <div class="detail-comments-section">
                    <div class="comments-header">
                        <h3><i class="fas fa-comments"></i> 用户评论</h3>
                        <span class="comments-count" id="commentsCount">(0)</span>
                    </div>

                    <!-- 评论输入框 -->
                    <div class="comment-input-area">
                        <div class="comment-avatar">U</div>
                        <div class="comment-input-wrapper">
                            <textarea class="comment-input" placeholder="分享你的想法..." id="commentInput"></textarea>
                            <div class="comment-actions">
                                <button class="comment-submit-btn" id="submitComment">
                                    <i class="fas fa-paper-plane"></i> 发表评论
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 评论列表 -->
                    <div class="comments-list" id="commentsList">
                        <!-- 评论将通过JavaScript动态加载 -->
                    </div>
                </div>
            </section>
        </section>

        <!-- 右侧：专家分析、相关标签、相关知识 -->
        <aside class="detail-sidebar-right">
            <!-- 专家分析 -->
            <div class="expert-analysis card-container">
                <div class="analysis-header">
                    <i class="fas fa-microscope"></i>
                    <h3>专家分析</h3>
                </div>
                <div class="analysis-content" id="expertAnalysis">
                    <div class="analysis-item">
                        <div class="analysis-score">
                            <span class="score-label">实用度</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: 95%"></div>
                            </div>
                            <span class="score-value">9.5/10</span>
                        </div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-score">
                            <span class="score-label">专业度</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: 90%"></div>
                            </div>
                            <span class="score-value">9.0/10</span>
                        </div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-score">
                            <span class="score-label">可操作性</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: 88%"></div>
                            </div>
                            <span class="score-value">8.8/10</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 相关标签 -->
            <div class="related-tags card-container">
                <div class="tags-header">
                    <i class="fas fa-tags"></i>
                    <h3>相关标签</h3>
                </div>
                <div class="tags-content" id="relatedTags">
                    <span class="tag">日本企业注册</span>
                    <span class="tag">税务规划</span>
                    <span class="tag">法律合规</span>
                </div>
            </div>

            <!-- 相关知识推荐 -->
            <div class="related-knowledge card-container">
                <h3><i class="fas fa-book-open"></i> 相关知识</h3>
                <ul id="relatedKnowledgeList">
                    <!-- 相关知识将通过JavaScript动态加载 -->
                </ul>
            </div>
        </aside>
    </main>

    <!-- 页脚 -->
    <footer id="footer">
        <!-- 页脚内容将通过 components.js 动态加载 -->
    </footer>

    <!-- JavaScript文件 -->
    <!-- 优先加载：主题管理器必须最先初始化 -->
    
    <script src="./components/unified-device-detector.js" defer></script>

    <!-- 组件脚本 - 依赖主题系统初始化 -->
    <script src="./script.js?v=2.2" defer></script>
    <script src="./components/enhanced-performance-monitor.js" defer></script>
    <script src="./components/foldable-device-detector.js" defer></script>
    <script src="./components/components.js" defer></script>
    <script src="./components/knowledge-detail.js?v=2.1" defer></script>

    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 优先初始化统一设备检测器
            if (window.UnifiedDeviceDetector) {
                window.unifiedDeviceDetector = new UnifiedDeviceDetector();
                window.unifiedDeviceDetector.init();

                // 禁用其他设备检测系统的设备类名添加功能
                if (window.MobiusResponsive) {
                    window.MobiusResponsive.setDeviceDetectionEnabled(false);
                }
                if (window.responsiveDetector) {
                    window.responsiveDetector.disableDeviceClassAddition();
                }
            }

            // 初始化组件
            if (window.componentManager) {
                window.componentManager.init();
            }

            // 初始化知识详情功能
            if (window.KnowledgeDetail) {
                window.knowledgeDetail = new KnowledgeDetail();
                window.knowledgeDetail.init();
            }
        });

              // 键盘导航支持
                document.addEventListener('keydown', function (e) {
                    // ESC键返回知识库
                    if (e.key === 'Escape') {
                        window.location.href = './knowledge.html';
                    }
                });
    </script>
</body>
</html>